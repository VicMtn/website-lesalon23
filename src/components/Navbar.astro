---
import { siteConfig, navigationConfig } from "../config/site.config";
import Button from "./Button.astro";
---

<header id="navbar" class="fixed top-0 left-0 right-0 z-50 bg-primary-600 shadow-lg">
  <nav class="container-custom">
    <div class="flex items-center justify-between h-20">
      <!-- Logo -->
      <a 
        href="#hero" 
        class="flex items-center gap-2 group"
        aria-label="Retour à l'accueil"
      >
        <span class="text-2xl md:text-3xl font-heading font-semibold text-white group-hover:text-primary-300 transition-colors">
          {siteConfig.name}
        </span>
      </a>

      <!-- Navigation Desktop -->
      <div class="hidden lg:flex items-center gap-1">
        {navigationConfig.map((item) => (
          <a
            href={item.href}
            class="nav-link px-4 py-2 text-white/90 hover:text-primary-300 font-medium transition-colors relative group"
          >
            {item.label}
            <span class="absolute bottom-0 left-1/2 -translate-x-1/2 w-0 h-0.5 bg-primary-400 transition-all duration-300 group-hover:w-3/4"></span>
          </a>
        ))}
      </div>

      <!-- CTA Desktop -->
      <div class="hidden lg:block">
        <Button href={siteConfig.bookingUrl} variant="primary" size="sm">
          Réserver
        </Button>
      </div>

      <!-- Bouton Menu Mobile -->
      <button
        id="mobile-menu-button"
        class="lg:hidden flex flex-col gap-1.5 p-2 group"
        aria-label="Ouvrir le menu"
        aria-expanded="false"
      >
        <span class="hamburger-line w-6 h-0.5 bg-white transition-all duration-300 origin-center"></span>
        <span class="hamburger-line w-6 h-0.5 bg-white transition-all duration-300"></span>
        <span class="hamburger-line w-6 h-0.5 bg-white transition-all duration-300 origin-center"></span>
      </button>
    </div>
  </nav>

  <!-- Menu Mobile -->
  <div
    id="mobile-menu"
    class="lg:hidden fixed inset-0 z-50 bg-primary-600 text-white pt-24 pb-10 transition-transform duration-300 ease-out translate-x-full pointer-events-none overflow-y-auto"
  >
    <div class="flex flex-col items-center justify-start min-h-full gap-6 px-8">
      {navigationConfig.map((item) => (
        <a
          href={item.href}
          class="mobile-nav-link text-2xl font-heading text-white hover:text-primary-300 transition-colors"
        >
          {item.label}
        </a>
      ))}
      <div class="mt-8">
        <Button href={siteConfig.bookingUrl} variant="primary" size="lg">
          Réserver maintenant
        </Button>
      </div>
    </div>
  </div>
</header>

<style>
  /* Animation du menu hamburger */
  #mobile-menu-button.active .hamburger-line:nth-child(1) {
    transform: translateY(8px) rotate(45deg);
  }

  #mobile-menu-button.active .hamburger-line:nth-child(2) {
    opacity: 0;
  }

  #mobile-menu-button.active .hamburger-line:nth-child(3) {
    transform: translateY(-8px) rotate(-45deg);
  }
</style>

<script is:inline>
  const menuBtn = document.getElementById("mobile-menu-button");
  const menu = document.getElementById("mobile-menu");

  if (!menuBtn || !menu) {
    // Fail-safe: if markup changes, don't crash the page.
    console.warn("[Navbar] mobile menu elements not found");
  } else {
    const setOpen = (open) => {
      menuBtn.classList.toggle("active", open);
      menuBtn.setAttribute("aria-expanded", open ? "true" : "false");
      menu.classList.toggle("translate-x-full", !open);
      menu.classList.toggle("pointer-events-none", !open);
      document.body.style.overflow = open ? "hidden" : "";
    };

    // Toggle menu
    menuBtn.addEventListener("click", () => {
      const open = !menuBtn.classList.contains("active");
      setOpen(open);
    });

    // Close on nav link click
    menu.addEventListener("click", (e) => {
      const target = e.target;
      if (target && target.closest && target.closest(".mobile-nav-link")) {
        setOpen(false);
      }
    });

    // Close on Escape
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") setOpen(false);
    });

    // Ensure correct initial state (e.g. if user navigates with bfcache)
    setOpen(false);
  }
</script>

